1) Создать с помощью Vagrant три машины - manager, node01, node02. Не устанавливать с помощью shell-скриптов docker при создании машин на Vagrant! Прокинуть порты node01 на локальную машину для доступа к пока еще не развернутому микросервисному приложению.

![task_01](../misc/images/task_01.png)

2) Подготовить manager как рабочую станцию для удаленного конфигурирования (помощь по Ansible в материалах).
- Зайти на manager. 
- На manager проверить подключение к node01 через ssh по приватной сети. 
- Сгенерировать ssh-ключ для подключения к node01 из manager (без passphrase). 
- Скопировать на manager docker-compose файл и исходный код микросервисов. (Используй проект из папки src и docker-compose файл из предыдущей главы. Помощь по ssh в материалах.)
- Установить Ansible на менеджер и создать папку ansible, в которой создать inventory-файл. 
- Использовать модуль ping для проверки подключения через Ansible. 
- Результат выполнения модуля поместить в отчет.


![task_02](../misc/images/task_02.png)


3) Написать первый плейбук для Ansible, который выполняет apt update, устанавливает docker, docker-compose, копирует compose-файл из manager'а и разворачивает микросервисное приложение. 

![task_03](../misc/images/task_03.png)


4) Прогнать заготовленные тесты через postman и удостовериться, что все они проходят успешно. В отчете отобразить результаты тестирования.

![task_04_1](../misc/images/task_04_1.png)
![task_04_2](../misc/images/task_04_2.png)


5) Сформировать три роли: 
 - роль application выполняет развертывание микросервисного приложения при помощи docker-compose,
 - apache устанавливает и запускает стандартный apache сервер
 - postgres устанавливает и запускает postgres, создает базу данных с произвольной таблицей и добавляет в нее три произвольные записи. 
 - Назначить первую роль node01 и вторые две роли node02, проверить postman-тестами работоспособность микросервисного приложения, удостовериться в доступности postgres и apache-сервера. 

![task_05](../misc/images/task_05.png)

6) Созданные в этом разделе файлы разместить в папке `src\ansible01` в личном репозитории.

## Part 2. Service Discovery

Теперь перейдем к обнаружению сервисов. В этой главе тебе предстоит cымитировать два удаленных сервиса - api и БД, и осуществить между ними подключение через Service Discovery с использованием Consul.

**== Задание ==**

1) Написать два конфигурационный файла для consul (информация по consul в материалах):
- consul_server.hcl:
   - настроить агент как сервер;
   - указать в advertise_addr интерфейс, направленный во внутреннюю сеть Vagrant
- consul_client.hcl:
   - настроить агент как клиент;
   - указать в advertise_addr интерфейс, направленный во внутреннюю сеть Vagrant
   
![task_05](../misc/images/part_02_ex_01.png)

2) Создать с помощью Vagrant три машины - consul_server, api и db. 
- Прокинуть порт 8082 с api на локальную машину для доступа к пока еще не развернутому api
- Прокинуть порт 8500 с manager для доступа к ui consul. 
- Перенести на consul_server предварительно собранный jar-файл из исходного кода в папке `src/services/hotels_service` и подготовленные конфиги для consul.

3) Написать плейбук для ansible и четыре роли: 
- install_consul_server, которая:
   - работает с consul_server;
   - копирует consul_server.hcl;
   - устанавливает consul и необходимые для consul зависимости;
   - запускает сервис consul
- install_consul_client, которая:
   - работает с api и db;
   - копирует consul_client.hcl;
   - устанавливает consul, envoy и необходимые для consul зависимости; 
   - запускает сервис consul и consul-envoy;
- install_db, которая:
   - работает с db;
   - устанавливает postgres и запускает его;
   - создает базу данных `hotels_db`;
- install_hotels_service, которая:
   - работает с api;
   - копирует исходный код сервиса
   - устанавлвиает `openjdk-8-jdk`
   - создает глобальные переменные окружения:
      - POSTGRES_HOST="127.0.0.1"
      - POSTGRES_PORT="5432"
      - POSTGRES_DB="hotels_db"
      - POSTGRES_USER="<имя пользователя>"
      - POSTGRES_PASSWORD="<пароль пользователя>"
   - запускает собранный jar-файл командой `java -jar <путь до hotel-service>/hotel-service/target/<имя jar-файла>.jar`

4) Прогнать заготовленные тесты через postman на хосте и удостовериться, что все они проходят успешно. В отчете отобразить результаты тестирования.

5) Созданные в этом разделе файлы разместить в папках `src\ansible02` и `src\consul01` в личном репозитории.
